#!/bin/sh

PAC=(-Syu --noconfirm --needed)
AUR=(-Axu --noconfirm --needed)

if [[ ! $(command -v aura) ]]
then
    sudo pacman "${PAC[@]}" curl

    echo "Installing Aura"
    cd /tmp
    curl https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=aura-bin > PKGBUILD
    makepkg
    echo Y | sudo pacman -U aura-bin/aura-bin*.tar.xz
    cd -
fi

# basic packages
PAC+=(xorg-server)                     # xorg-server
PAC+=(xorg-xinit)                      # xorg-xinit
PAC+=(xorg-xrdb)                       # xorg-xrdb
PAC+=(xorg-xmodmap)                    # xorg-xmodmap
PAC+=(xf86-input-libinput)             # xf86-input-libinput
PAC+=(slim)                            # slim
PAC+=(systemd)                         # systemd
PAC+=(openssh)                         # openssh
PAC+=(sysstat)                         # mostly for iostat

# fonts
PAC+=(ttf-dejavu)                      # ttf-dejavu
PAC+=(terminus-font)                   # terminus-font
PAC+=(noto-fonts-cjk)                  # noto-fonts-cjk
PAC+=(noto-fonts-emoji)                # noto-fonts-emoji
PAC+=(xorg-fonts-misc)                 # xorg-fonts-misc
PAC+=(ttf-nerd-fonts-symbols)          # ttf-nerd-fonts-symbols
AUR+=(ttf-font-awesome-4)              # ttf-font-awesome-4

# display manager packages
PAC+=(xorg-server-xephyr)              # helps testing lightdm on X
PAC+=(lightdm)                         # lightdm
PAC+=(lightdm-gtk-greeter)             # lightdm-gtk-greeter
PAC+=(accountsservice)                 # accountsservice

# wireless packages
PAC+=(wpa_supplicant)                  # wpa_supplicant
PAC+=(netctl)                          # netctl
PAC+=(networkmanager)                  # networkmanager
PAC+=(network-manager-applet)          # network-manager-applet

# sound packages
PAC+=(pulseaudio)                      # pulseaudio
PAC+=(pavucontrol)                     # pavucontrol

# basic tools"
PAC+=(rsync)                           # rsync
PAC+=(ntp)                             # ntp
PAC+=(xsel)                            # add data to clipboard via command line
PAC+=(unzip)                           # extract .zip files
PAC+=(unrar)                           # extract .rar files
PAC+=(imagemagick)                     # imagemagick
PAC+=(bash-completion)                 # bash-completion
PAC+=(alsa-utils)                      # alsa-utils
PAC+=(redshift)                        # makes the screen red at night
PAC+=(gnome-calculator)                # default calculator for gnome
PAC+=(xournalpp)                       # annotate PDFs
PAC+=(hugo)                            # static pagde generator

# rust alternative to common commands
PAC+=(exa)                             # alternative to ls
PAC+=(ripgrep)                         # alternative to grep
PAC+=(bat)                             # alternative to cat
PAC+=(fd)                              # alternative to find
PAC+=(sd)                              # alternative to sed

AUR+=(starship)

# development tools
PAC+=(base-devel)                      # base-devel
PAC+=(git)                             # git
PAC+=(jq)                              # jq
PAC+=(tmux)                            # tmux
AUR+=(ngrok)                           # ngrok
AUR+=(ruby-build)                      # ruby-build
AUR+=(android-sdk-platform-tools)      # android-sdk-platform-tools
AUR+=(wakatime)                        # wakatime
AUR+=(heroku-cli)                      # heroku-cli

# languages
PAC+=(ruby)                            # system version of ruby (dep for packages)
PAC+=(python)                          # system version of python (dep for packages)
PAC+=(python2)                         # system version of python2 (dep for packages)
PAC+=(nodejs)                          # system version of nodejs (dep for packages)
PAC+=(go)                              # system version of go (dep for packages)
PAC+=(elixir)                          # system version of elixir (dep for packages)
AUR+=(asdf-vm)                         # default way to install programming languages

# python packages
PAC+=(flake8)                          # flake8

# docker
PAC+=(docker)                          # docker
PAC+=(docker-compose)                  # docker-compose

# editors
PAC+=(emacs)                           # emacs
PAC+=(aspell-pt)                       # aspell-pt
PAC+=(aspell-en)                       # aspell-en
PAC+=(vim)                             # vim

# xfce4
PAC+=(xfce4)                           # xfce4
PAC+=(xfce4-goodies)                   # xfce4-goodies
PAC+=(mupdf)                           # mupdf
PAC+=(file-roller)                     # file-roller
PAC+=(gvfs)                            # gvfs

AUR+=(sardi-icons)                     # sardi-icons
AUR+=(xfce4-hardware-monitor-plug)     # xfce4-hardware-monitor-plug
# AUR+=(xfwm-axiom-theme)  # I'm using it but it's not working via AUR

# i3/sway
PAC+=(i3-wm)                           # i3-wm
PAC+=(i3lock)                          # i3lock
PAC+=(i3status)                        # i3status
PAC+=(i3blocks)                        # i3blocks
PAC+=(sway)                            # sway
PAC+=(rxvt-unicode)                    # rxvt-unicode

# common software
PAC+=(gimp)                            # gimp
PAC+=(inkscape)                        # inkscape
PAC+=(texlive-bin)                     # texlive-bin
PAC+=(dos2unix)                        # dos2unix
PAC+=(shotwell)                        # shotwell
PAC+=(keybase)                         # keybase
PAC+=(audacity)                        # audacity
PAC+=(transmission-gtk)                # transmission-gtk
PAC+=(peek)                            # peek

AUR+=(dropbox)                         # dropbox
AUR+=(zoom)                            # zoom
AUR+=(gdrive)                          # gdrive
AUR+=(telegram-desktop)                # telegram-desktop

# tools and monitoring software
PAC+=(bandwhich)                       # bandwhich

# video software
PAC+=(vlc)                             # vlc
PAC+=(obs-studio)                      # obs-studio

# entretainment software
PAC+=(steam)                           # steam

# browsers
PAC+=(firefox)                         # firefox
PAC+=(chromium)                        # chromium

# productivity related software
AUR+=(rescuetime2)                     # rescuetime2
AUR+=(toggldesktop)                    # toggldesktop

# kernel flavors
PAC+=(linux-zen)                       # linux-zen
PAC+=(linux-zen-headers)               # linux-zen-headers
PAC+=(linux-headers)                   # linux-headers

# Laptop improvements (mostly thinkpad specifics)"
PAC+=(acpid)                           # acpid
PAC+=(tlp)                             # tlp
PAC+=(smartmontools)                   # smartmontools
PAC+=(ethtool)                         # ethtool
PAC+=(acpi_call)                       # acpi_call
PAC+=(throttled)                       # throttled

# Install virtualization software"
PAC+=(virtualbox)                      # virtualbox
PAC+=(virtualbox-host-modules-arch)    # virtualbox-host-modules-arch

# Install all packages named before
sudo pacman "${PAC[@]}"
sudo aura   "${AUR[@]}"

# Update all dependencies
sudo pacman -Syu --noconfirm
sudo aura   -Axu --noconfirm

# If asdf is installed, update all plugins
asdf plugin add elixir
asdf plugin add golang
asdf plugin add nodejs
asdf plugin add python
asdf plugin add ruby
asdf plugin add rust

asdf plugin update --all

LATEST_ELIXIR=$(asdf list all elixir | rg "^\d+\.\d+\.\d+-otp.*$" | tail -n 1)
LATEST_GOLANG=$(asdf list all golang | rg "^\d+\.\d+\.\d+$" | tail -n 1)
LATEST_NODEJS=$(asdf list all nodejs | rg "^\d+\.\d+\.\d+$" | tail -n 1)
LATEST_PYTHON=$(asdf list all python | rg "^\d+\.\d+\.\d+$" | tail -n 1)
LATEST_RUBY=$(asdf list all ruby | rg "^\d+\.\d+\.\d+$" | tail -n 1)

asdf install elixir $LATEST_ELIXIR
asdf global elixir $LATEST_ELIXIR

asdf install golang $LATEST_GOLANG
asdf global golang $LATEST_GOLANG

sh ~/.asdf/plugins/nodejs/bin/import-release-team-keyring 2>/dev/null
asdf install nodejs $LATEST_NODEJS
asdf global nodejs $LATEST_NODEJS

asdf install python $LATEST_PYTHON
asdf global python $LATEST_PYTHON

asdf install ruby $LATEST_RUBY
asdf global ruby $LATEST_RUBY

asdf install rust stable
asdf install rust nightly
asdf global rust nightly
cargo +nightly install racer -q

echo "Activate needed services"
sudo systemctl enable ntpd.service
sudo systemctl enable NetworkManager.service
sudo systemctl enable acpid.service
sudo systemctl enable nscd.service
sudo systemctl enable lightdm.service
sudo systemctl enable lenovo_fix.service

exit 0
