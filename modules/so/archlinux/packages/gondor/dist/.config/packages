#!/bin/sh

echo "Updating repos"
sudo pacman -Syyu --noconfirm

# aura-bin dependency
sudo pacman -S --noconfirm --needed curl

if [[ ! $(command -v aura) ]]
then
    echo "Installing Aura"
    cd /tmp
    curl https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=aura-bin > PKGBUILD
    makepkg
    echo Y | sudo pacman -U aura-bin/aura-bin*.tar.xz
    cd -
fi

sudo aura -Axu --noconfirm

echo "Installing basic packages"
sudo pacman -S --noconfirm --needed \
     xorg-server \
     xorg-xinit \
     xorg-xrdb \
     xorg-xmodmap \
     xf86-input-libinput \
     slim \
     systemd \
     openssh \
     sysstat

echo "Installing display manager packages"
# helps testing lightdm on X
sudo pacman -S --noconfirm --needed xorg-server-xephyr
sudo pacman -S --noconfirm --needed \
     lightdm \
     lightdm-gtk-greeter \
     accountsservice

echo "Installing wireless packages"
sudo pacman -S --noconfirm --needed \
     wpa_supplicant \
     netctl \
     networkmanager \
     network-manager-applet

echo "Installing sound packages"
sudo pacman -S --noconfirm --needed \
     pulseaudio \
     pavucontrol

echo "Installing fonts"
sudo pacman -S --noconfirm --needed \
     ttf-dejavu \
     terminus-font \
     noto-fonts-cjk \
     noto-fonts-emoji \
     xorg-fonts-misc \
     ttf-nerd-fonts-symbols

sudo aura -Ax --noconfirm --needed ttf-font-awesome-4

echo "Installing basic tools"
sudo pacman -S --noconfirm --needed \
     rsync \
     ntp \
     ripgrep \
     xsel \
     unzip \
     unrar \
     imagemagick \
     bash-completion \
     alsa-utils \
     redshift \
     gnome-calculator \
     xournalpp \
     hugo

echo "Installing development tools"
sudo pacman -S --noconfirm --needed \
     base-devel \
     git \
     jq \
     tmux

sudo aura -Ax --noconfirm --needed \
     ngrok \
     ruby-build \
     android-sdk-platform-tools \
     wakatime \
     heroku-cli

echo "Installing languages"
sudo pacman -S --noconfirm --needed \
     ruby \
     python \
     python2 \
     nodejs \
     go \
     elixir \
     rustup

echo "Essential python packages"
sudo pacman -S --noconfirm --needed \
     flake8 \
     python2-flake8

echo "Preparing Rust language"
rustup set profile complete
rustup install stable
rustup default stable
rustup component add rustfmt-preview
rustup component add clippy-preview

rustup install nightly
rustup default nightly
rustup component add rustfmt-preview
rustup component add clippy-preview
cargo +nightly install racer -q

echo "Docker"
sudo pacman -S --noconfirm --needed \
     docker \
     docker-compose

echo "Installing editors"
sudo pacman -S --noconfirm --needed \
     emacs \
     aspell-pt \
     aspell-en \
     vim

echo "Installing xfce4"
sudo pacman -S --noconfirm --needed \
     xfce4 \
     xfce4-goodies \
     mupdf \
     file-roller \
     gvfs

sudo aura -Ax --noconfirm --needed \
     sardi-icons \
     xfce4-hardware-monitor-plugin
#     xfwm-axiom-theme  # I'm using it but it's not working via AUR

echo "Installing i3/sway"
sudo pacman -S --noconfirm --needed \
     i3-wm \
     i3lock \
     i3status \
     sway \
     rxvt-unicode

sudo aura -Ax --noconfirm --needed i3blocks

echo "Installing common software"
sudo pacman -S --noconfirm --needed \
     gimp \
     inkscape \
     texlive-bin \
     dos2unix \
     shotwell \
     keybase \
     audacity \
     transmission-gtk \
     peek

sudo aura -Ax --noconfirm --needed \
     dropbox \
     zoom \
     gdrive \
     telegram-desktop

echo "Installing tools and monitoring software"
sudo pacman -S --noconfirm --needed bandwhich

echo "Installing video software"
sudo pacman -S --noconfirm --needed \
     vlc \
     obs-studio

echo "Installing entretainment software"
sudo pacman -S --noconfirm --needed steam

echo "Installing browsers"
sudo pacman -S --noconfirm --needed firefox chromium

echo "Installing productivity related software"
sudo aura -A  --noconfirm --needed \
     rescuetime2 \
     toggldesktop

echo "Installing kernel flavors"
sudo pacman -S --noconfirm --needed linux-zen linux-zen-headers
sudo pacman -S --noconfirm --needed linux-headers

echo "Laptop improvements (mostly thinkpad specifics)"
sudo pacman -S --noconfirm --needed \
     acpid \
     tlp \
     smartmontools \
     ethtool \
     acpi_call \
     throttled

echo "Install virtualization software"
sudo pacman -S --noconfirm --needed \
    virtualbox \
    virtualbox-host-modules-arch

echo "Activate needed services"
sudo systemctl enable ntpd.service
sudo systemctl enable NetworkManager.service
sudo systemctl enable acpid.service
sudo systemctl enable nscd.service
sudo systemctl enable lightdm.service
sudo systemctl enable lenovo_fix.service

exit 0
