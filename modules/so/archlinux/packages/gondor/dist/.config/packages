#!/bin/sh

PAC=(-S --noconfirm --needed)
AUR=(-Ax --noconfirm --needed)

sudo pacman -Sy --noconfirm

# aura-bin dependency
sudo pacman "${PAC[@]}" curl

if [[ ! $(command -v aura) ]]
then
    echo "Installing Aura"
    cd /tmp
    curl https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=aura-bin > PKGBUILD
    makepkg
    echo Y | sudo pacman -U aura-bin/aura-bin*.tar.xz
    cd -
fi

# basic packages
PAC+=(xorg-server)
PAC+=(xorg-xinit)
PAC+=(xorg-xrdb)
PAC+=(xorg-xmodmap)
PAC+=(xf86-input-libinput)
PAC+=(slim)
PAC+=(systemd)
PAC+=(openssh)
PAC+=(sysstat)                         # mostly for iostat

# fonts
PAC+=(ttf-dejavu)
PAC+=(terminus-font)
PAC+=(noto-fonts-cjk)
PAC+=(noto-fonts-emoji)
PAC+=(xorg-fonts-misc)
PAC+=(ttf-nerd-fonts-symbols)
AUR+=(ttf-font-awesome-4)

# display manager packages
PAC+=(xorg-server-xephyr) # helps testing lightdm on X
PAC+=(lightdm)
PAC+=(lightdm-gtk-greeter)
PAC+=(accountsservice)

# wireless packages
PAC+=(wpa_supplicant)
PAC+=(netctl)
PAC+=(networkmanager)
PAC+=(network-manager-applet)

# sound packages
PAC+=(pulseaudio)
PAC+=(pavucontrol)

# basic tools"
PAC+=(rsync)
PAC+=(ntp)
PAC+=(xsel)                            # add data to clipboard via command line
PAC+=(unzip)                           # extract .zip files
PAC+=(unrar)                           # extract .rar files
PAC+=(imagemagick)
PAC+=(bash-completion)
PAC+=(alsa-utils)
PAC+=(redshift)                        # makes the screen red at night
PAC+=(gnome-calculator)                # default calculator for gnome
PAC+=(xournalpp)                       # annotate PDFs
PAC+=(hugo)                            # static pagde generator

# rust alternative to common commands
PAC+=(exa)                             # alternative to ls
PAC+=(ripgrep)                         # alternative to grep
PAC+=(bat)                             # alternative to cat
PAC+=(fd)                              # alternative to find
PAC+=(sd)                              # alternative to sed

AUR+=(starship)

# development tools
PAC+=(base-devel)
PAC+=(git)
PAC+=(jq)
PAC+=(tmux)

AUR+=(ngrok)
AUR+=(ruby-build)
AUR+=(android-sdk-platform-tools)
AUR+=(wakatime)
AUR+=(heroku-cli)

# languages
PAC+=(ruby)
PAC+=(python)
PAC+=(python2)
PAC+=(nodejs)
PAC+=(go)
PAC+=(elixir)
PAC+=(rustup)

# python packages
PAC+=(flake8)

# docker
PAC+=(docker)
PAC+=(docker-compose)

# editors
PAC+=(emacs)
PAC+=(aspell-pt)
PAC+=(aspell-en)
PAC+=(vim)

# xfce4
PAC+=(xfce4)
PAC+=(xfce4-goodies)
PAC+=(mupdf)
PAC+=(file-roller)
PAC+=(gvfs)

AUR+=(sardi-icons)
AUR+=(xfce4-hardware-monitor-plug)
# AUR+=(xfwm-axiom-theme)  # I'm using it but it's not working via AUR

# i3/sway
PAC+=(i3-wm)
PAC+=(i3lock)
PAC+=(i3status)
PAC+=(i3blocks)
PAC+=(sway)
PAC+=(rxvt-unicode)

# common software
PAC+=(gimp)
PAC+=(inkscape)
PAC+=(texlive-bin)
PAC+=(dos2unix)
PAC+=(shotwell)
PAC+=(keybase)
PAC+=(audacity)
PAC+=(transmission-gtk)
PAC+=(peek)

AUR+=(dropbox)
AUR+=(zoom)
AUR+=(gdrive)
AUR+=(telegram-desktop)

# tools and monitoring software
PAC+=(bandwhich)

# video software
PAC+=(vlc)
PAC+=(obs-studio)

# entretainment software
PAC+=(steam)

# browsers
PAC+=(firefox)
PAC+=(chromium)

# productivity related software
AUR+=(rescuetime2)
AUR+=(toggldesktop)

# kernel flavors
PAC+=(linux-zen)
PAC+=(linux-zen-headers)
PAC+=(linux-headers)

# Laptop improvements (mostly thinkpad specifics)"
PAC+=(acpid)
PAC+=(tlp)
PAC+=(smartmontools)
PAC+=(ethtool)
PAC+=(acpi_call)
PAC+=(throttled)

# Install virtualization software"
PAC+=(virtualbox)
PAC+=(virtualbox-host-modules-arch)

# Install all packages named before
sudo pacman "${PAC[@]}"
sudo aura   "${AUR[@]}"

# Update all dependencies
sudo pacman -Syu --noconfirm
sudo aura   -Axu --noconfirm

# If asdf is installed, update all plugins
command -v asdf >/dev/null && asdf plugin update --all

echo "Preparing Rust language"
rustup set profile complete
rustup install stable
rustup default stable
rustup component add rustfmt-preview
rustup component add clippy-preview

rustup install nightly
rustup default nightly
rustup component add rustfmt-preview
rustup component add clippy-preview
cargo +nightly install racer -q

echo "Activate needed services"
sudo systemctl enable ntpd.service
sudo systemctl enable NetworkManager.service
sudo systemctl enable acpid.service
sudo systemctl enable nscd.service
sudo systemctl enable lightdm.service
sudo systemctl enable lenovo_fix.service

exit 0
